<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Center Energy Consumption</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use the Inter font */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom style for the "live" button */
        .btn-active {
            background-color: #4f46e5; /* indigo-600 */
            color: #ffffff;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-gray-800 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-2xl mx-auto">
        
        <!-- Header -->
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-indigo-300 mb-6">Data Center Energy Consumption</h1>
        
        <!-- Region Selector -->
        <div class="flex justify-center space-x-2 sm:space-x-4 mb-6">
            <button id="btn-global" class="region-btn btn-active text-sm sm:text-base px-4 py-2 rounded-lg font-medium transition-colors duration-200">Global</button>
            <button id="btn-usa" class="region-btn bg-gray-700 hover:bg-gray-600 text-sm sm:text-base px-4 py-2 rounded-lg font-medium transition-colors duration-200">United States</button>
            <button id="btn-china" class="region-btn bg-gray-700 hover:bg-gray-600 text-sm sm:text-base px-4 py-2 rounded-lg font-medium transition-colors duration-200">China</button>
        </div>

        <!-- Main Display -->
        <div class="bg-gray-900 p-6 rounded-lg text-center mb-6">
            <div id="display-title" class="text-sm sm:text-base font-medium text-indigo-400 mb-2">Live Total Since Jan 1, 2024</div>
            <div id="display-value" class="text-4xl sm:text-6xl font-extrabold text-white" style="min-height: 80px;">...</div>
            <div id="display-unit" class="text-lg sm:text-2xl text-gray-400">kWh</div>
        </div>

        <!-- How is this Calculated Button -->
        <div class="text-center mb-6">
            <button id="btn-how" class="text-indigo-300 hover:text-indigo-200 text-sm font-medium">
                How is this calculated?
            </button>
        </div>


        <!-- Footer -->
        <p class="text-xs text-gray-500 text-center mt-6">
            Data based on 2024 baselines and 2030 projections from the 
            <a href="https://www.iea.org/reports/energy-and-ai" target="_blank" rel="noopener noreferrer" class="text-indigo-400 hover:text-indigo-300 underline">International Energy Agency (IEA) 'Energy and AI' report</a>
             (2024/2025). This is a simplified model for illustrative purposes.
        </p>

    </div>

    <!-- Explanation Modal -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-lg p-6 relative">
            <button id="btn-close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h3 class="text-xl font-bold text-indigo-300 mb-4">How This is Calculated</h3>
            <div class="text-gray-300 space-y-3 text-sm">
                <p>This counter models accelerating energy consumption using an exponential growth formula based on professional data.</p>
                <ol class="list-decimal list-inside space-y-2 pl-2">
                    <li><strong>Baseline Data:</strong> The 2024 annual consumption estimates (e.g., Global: 415 TWh, US: 183 TWh) from the International Energy Agency (IEA).</li>
                    <li><strong>Growth Rate:</strong> <span class="font-mono font-medium text-indigo-200">Compound Annual Growth Rate (CAGR)</span> calculated by comparing the 2024 baseline to the IEA's 2030 projection (e.g., Global: 945 TWh).</li>
                    <li><strong>Live Counter:</strong> The "live" number is the cumulative energy consumed since Jan 1, 2024. It's calculated by integrating the exponential growth function:
                        <br>
                        <span class="block text-center font-mono bg-gray-900 p-2 rounded-md my-2 text-xs sm:text-sm">Total = (BaseTWh * ((1 + Rate)<sup>Years</sup> - 1)) / ln(1 + Rate)</span>
                    </li>
                </ol>
                <p>This formula finds the total area under the exponential growth curve from the start date to the current second, giving a real-time estimate of total consumption.</p>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Data Constants based on IEA Reports ---
            const DATA_SOURCES = {
                global: { baseTWh: 415, growthRate: 0.147, label: 'Global' },
                usa: { baseTWh: 183, growthRate: 0.151, label: 'United States' },
                china: { baseTWh: 102, growthRate: 0.181, label: 'China' }
            };
            const START_DATE = new Date('2024-01-01T00:00:00Z');
            const END_DATE = new Date('2030-01-01T00:00:00Z');
            const SECONDS_PER_YEAR = 365.25 * 24 * 60 * 60; // 31,557,600
            const TWH_TO_KWH = 1_000_000_000;

            // --- State Variables ---
            let currentRegion = 'global';
            // currentView is removed, defaults to 'live'
            let liveIntervalId = null;

            // --- DOM Elements ---
            const displayTitle = document.getElementById('display-title');
            const displayValue = document.getElementById('display-value');
            const displayUnit = document.getElementById('display-unit');
            const regionButtons = document.querySelectorAll('.region-btn');
            // viewButtons removed
            const modal = document.getElementById('modal');
            const btnHow = document.getElementById('btn-how');
            const btnCloseModal = document.getElementById('btn-close-modal');

            // --- Helper Functions ---
            
            /**
             * Formats a large number with commas.
             * @param {number} num - The number to format.
             * @returns {string} - The formatted number.
             */
            function formatNumber(num) {
                // For 'live' view, we show whole numbers.
                const options = { maximumFractionDigits: 0 };
                return new Intl.NumberFormat('en-US', options).format(num);
            }

            /**
             * Calculates the current annual consumption rate (TWh/year)
             * based on exponential growth.
             * C(t) = P_0 * (1 + r)^t
             * @param {number} baseTWh - The initial TWh at t=0.
             * @param {number} growthRate - The annual growth rate (e.g., 0.15).
             * @param {number} yearsElapsed - The number of years elapsed since start.
             * @returns {number} - The current annual consumption rate in TWh.
             */
            function getCurrentAnnualRate(baseTWh, growthRate, yearsElapsed) {
                return baseTWh * Math.pow(1 + growthRate, yearsElapsed);
            }

            /**
             * Calculates the cumulative consumption (TWh) from t=0 to t=years.
             * Integral(P_0 * (1 + r)^t) dt = P_0 * [(1 + r)^t / ln(1 + r)]
             * Total = [C(t) / ln(1+r)] - [C(0) / ln(1+r)]
             * Total = (P_0 * (1+r)^t - P_0) / ln(1+r)
             * @param {number} baseTWh - The initial TWh at t=0.
             * @param {number} growthRate - The annual growth rate.
             * @param {number} yearsElapsed - The number of years elapsed.
             * @returns {number} - The cumulative TWh consumed.
             */
            function getCumulativeConsumption(baseTWh, growthRate, yearsElapsed) {
                if (growthRate === 0) {
                    return baseTWh * yearsElapsed;
                }
                const b = 1 + growthRate;
                const logB = Math.log(b);
                return (baseTWh * (Math.pow(b, yearsElapsed) - 1)) / logB;
            }

            /**
             * Main function to update the display based on state.
             */
            function updateDisplay() {
                // Clear any running "live" interval
                if (liveIntervalId) {
                    clearInterval(liveIntervalId);
                    liveIntervalId = null;
                }

                const data = DATA_SOURCES[currentRegion];
                
                let title = `Live Total Since Jan 1, 2024`;
                let unit = 'kWh';

                // Function to update the live counter
                const updateLiveCounter = () => {
                    const currentYears = (new Date().getTime() - START_DATE.getTime()) / (1000 * SECONDS_PER_YEAR);
                    const cumulativeTWh = getCumulativeConsumption(data.baseTWh, data.growthRate, currentYears);
                    const cumulativeKWh = cumulativeTWh * TWH_TO_KWH;
                    displayValue.textContent = formatNumber(cumulativeKWh);
                };
                
                updateLiveCounter(); // Run once immediately
                liveIntervalId = setInterval(updateLiveCounter, 100); // Update every 100ms

                displayTitle.textContent = title;
                displayUnit.textContent = unit;
            }

            /**
             * Handles region button clicks.
             */
            function selectRegion(e) {
                currentRegion = e.target.id.split('-')[1]; // e.g., "btn-global" -> "global"
                
                regionButtons.forEach(btn => {
                    btn.classList.remove('btn-active');
                    btn.classList.add('bg-gray-700', 'hover:bg-gray-600');
                });
                
                e.target.classList.add('btn-active');
                e.target.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                
                updateDisplay();
            }

            /**
             * Handles view/timeframe button clicks.
             */
            // selectView function removed

            // --- Add Event Listeners ---
            regionButtons.forEach(btn => btn.addEventListener('click', selectRegion));
            // viewButtons listener removed
            
            btnHow.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });

            btnCloseModal.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            
            // Close modal if clicking outside the content
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });

            // --- Initial Load ---
            updateDisplay();

        });
    </script>
</body>
</html>
